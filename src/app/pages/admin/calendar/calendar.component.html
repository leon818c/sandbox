<div class="page-container">
    <header class="page-header">
      <a class="back-btn-fancy" routerLink="/admin">
        <div class="back-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="arrow-icon">
            <path d="M19 12H5"></path>
            <path d="M12 19l-7-7 7-7"></path>
          </svg>
        </div>
        <span class="back-text">Admin Dashboard</span>
      </a>
    </header>
    
    <main class="content">
      <div class="calendar-container">
        <div class="calendar-header">
          <button class="nav-btn" (click)="previousMonth()">
            <span class="arrow">‹</span>
          </button>
          <h1 class="month-year">{{ currentMonthYear }}</h1>
          <button class="nav-btn" (click)="nextMonth()">
            <span class="arrow">›</span>
          </button>
        </div>
        
        <div class="calendar-grid">
          <div class="day-header" *ngFor="let day of dayHeaders">{{ day }}</div>
          
          <div 
            class="date-cell" 
            *ngFor="let date of calendarDates"
            [class.other-month]="!date.isCurrentMonth"
            [class.today]="date.isToday"
            [class.has-events]="date.events.length > 0"
            (click)="date.events.length > 0 ? openEventModal(date) : null"
          >
            <span class="date-number">{{ date.day }}</span>
            <div class="events desktop-events">
              <div 
                class="event" 
                *ngFor="let event of date.events"
                [class]="event.type"
              >
                {{ event.title }}
              </div>
            </div>
            <div class="mobile-events" *ngIf="date.events.length > 0">
              <div class="event-dots">
                <span 
                  class="event-dot" 
                  *ngFor="let event of date.events" 
                  [class]="event.type"
                ></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Event Modal -->
    @if (showEventModal) {
      <div class="modal-overlay" (click)="closeEventModal()">
        <div class="event-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>{{ getSelectedDateString() }} Events</h3>
            <button class="close-btn" (click)="closeEventModal()">×</button>
          </div>
          <div class="modal-content">
            <!-- View Mode -->
            <div *ngIf="!isEditing">
              <div 
                class="modal-event" 
                *ngFor="let event of selectedDate?.events; let i = index"
                [class]="event.type"
              >
                <div class="event-title">{{ event.title }}</div>
                <div class="event-time" *ngIf="event.time">{{ event.time }}</div>
                <div class="event-actions">
                  <button class="edit-btn" (click)="startEdit(event, i)">Edit</button>
                  <button class="delete-btn" (click)="deleteEvent(i)">Delete</button>
                </div>
              </div>
              
              <!-- Servers Section -->
              <div class="day-servers-section">
                <h3>Servers</h3>
                <div class="server-list">
                  @for (event of selectedDate?.events; track event; let i = $index) {
                    @if (event.servers && event.servers.length > 0) {
                      <div class="event-servers">
                        <h4>{{ event.title }}</h4>
                        <div class="server-items">
                          @for (server of event.servers; track server; let j = $index) {
                            <div class="server-item">
                              <span class="server-name">{{ server.name }}</span>
                              <button class="remove-server-btn" (click)="removeServer(i, j)">×</button>
                            </div>
                          }
                        </div>
                      </div>
                    }
                  }
                </div>
              </div>
              
              <div class="button-group">
                <button class="add-btn" (click)="addNewEvent()">Add New Event</button>
                <button class="servers-btn" (click)="insertServers()">Insert Servers</button>
              </div>
            </div>
            
            <!-- Edit Mode -->
            <div *ngIf="isEditing && editingEvent" class="event-edit-form">
              <div class="form-group">
                <label for="event-title">Title:</label>
                <input type="text" id="event-title" [(ngModel)]="editingEvent.title">
              </div>
              
              <div class="form-group">
                <label for="event-time">Time:</label>
                <input type="text" id="event-time" [(ngModel)]="editingEvent.time">
              </div>
              
              <div class="form-group">
                <label for="event-type">Type:</label>
                <select id="event-type" [(ngModel)]="editingEvent.type">
                  <option *ngFor="let type of eventTypes" [value]="type.value">{{ type.label }}</option>
                </select>
              </div>
              
              <div class="form-actions">
                <button class="save-btn" (click)="saveEdit()">Save</button>
                <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
    
    <!-- Server Selection Modal -->
    @if (showServerModal) {
      <div class="modal-overlay" (click)="closeServerModal()">
        <div class="server-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>Assign Servers</h3>
            <button class="close-btn" (click)="closeServerModal()">×</button>
          </div>
          <div class="modal-content">
            <p>Select an event and assign a server:</p>
            
            <div class="form-group">
              <label for="event-select">Event:</label>
              <select id="event-select" [(ngModel)]="selectedEventForServer">
                <option [value]="-1" disabled>Select an event</option>
                <option *ngFor="let event of selectedDate?.events; let i = index" [value]="i">
                  {{ event.title }}
                </option>
              </select>
            </div>
            
            <div class="form-group" *ngIf="selectedEventForServer >= 0">
              <div class="quick-update-form">
                <div class="search-container">
                  <input 
                    type="text" 
                    class="search-input"
                    placeholder="Start typing server name..."
                    [(ngModel)]="searchQuery"
                    (input)="filterServers()"
                    (focus)="showDropdown = true"
                  >
                  @if (showDropdown && filteredServers.length > 0) {
                    <div class="dropdown">
                      @for (server of filteredServers; track server.id) {
                        <div class="dropdown-item" (click)="selectServer(server)">
                          {{ server.name }}
                        </div>
                      }
                    </div>
                  }
                </div>
              </div>
              
              @if (selectedServer) {
                <div class="selected-info">
                  Selected: <strong>{{ selectedServer.name }}</strong>
                </div>
              }
            </div>
            
            <div class="form-actions">
              <button 
                class="save-btn" 
                [disabled]="selectedEventForServer < 0 || !selectedServer" 
                (click)="assignServer()"
              >Assign</button>
              <button class="cancel-btn" (click)="closeServerModal()">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    }
    
  </div>
  