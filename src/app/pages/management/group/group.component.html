<div class="group-container">
  <header class="page-header">
    <button class="back-btn" routerLink="/admin">← Back to Admin</button>
  </header>

  <div class="dashboard-header">
    <h1>Group Management</h1>
    <p>Manage altar server groups and their information</p>
  </div>

  <div class="action-bar">
    <button class="add-group-btn" (click)="showAddGroupModal = true">
      <span>✨</span> Add New Group
    </button>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2>Group Management</h2>
      <span class="count-badge">{{ groups.length }} groups</span>
    </div>
    
    @if (groups.length === 0) {
      <div class="management-links">
        <p>No groups created yet. Click "Add New Group" to get started!</p>
      </div>
    } @else {
      <div class="table-container">
        <table class="groups-table">
          <thead>
            <tr>
              <th>Group Name</th>
              <th>Members</th>
              <th>Member Points</th>
              <th>Group Points</th>
              <th>Total Points</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (group of groups; track group.name) {
              <tr>
                <td>{{ group.name }}</td>
                <td>
                  @if (group.members.length === 0) {
                    No members
                  } @else {
                    @for (member of group.members; track member.id; let last = $last) {
                      {{ member.full_name }}@if (!last) {, }
                    }
                  }
                </td>
                <td>{{ group.memberPoints || 0 }}</td>
                <td>
                  <div class="points-controls">
                    <button class="points-btn minus" (click)="subtractGroupPoints(group)">-</button>
                    <input 
                      type="number" 
                      [(ngModel)]="group.inputValue" 
                      class="points-input"
                      min="1"
                      max="100"
                    >
                    <button class="points-btn plus" (click)="addGroupPoints(group)">+</button>
                    <span class="current-points">Current: {{ group.groupPoints || 0 }}</span>
                  </div>
                </td>
                <td class="total-points">{{ group.totalPoints || 0 }}</td>
                <td>
                  <button class="edit-btn" (click)="editGroup(group)">Edit</button>
                  <button class="delete-btn" (click)="deleteGroup(group)">Delete</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>

  <!-- Add Group Modal -->
  @if (showAddGroupModal) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Add New Group</h2>
          <button class="close-btn" (click)="closeModal()">×</button>
        </div>
        
        <form (ngSubmit)="addGroup()" class="group-form">
          <div class="form-group">
            <label for="groupName">Group Name *</label>
            <input 
              id="groupName"
              type="text" 
              [(ngModel)]="newGroupName" 
              name="groupName" 
              placeholder="Enter group name"
              required 
            />
          </div>

          <div class="form-group">
            <label for="memberSelect">Select Members</label>
            <select 
              id="memberSelect"
              multiple
              [(ngModel)]="selectedMemberIds"
              name="memberSelect"
              class="members-dropdown"
            >
              @for (server of availableServers; track server.id) {
                <option [value]="server.id">{{ server.full_name }} ({{ server.grade }})</option>
              }
            </select>
            <small class="help-text">Hold Ctrl/Cmd to select multiple members</small>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="closeModal()">Cancel</button>
            <button type="submit" class="submit-btn">✨ Create Group</button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Edit Group Modal -->
  @if (showEditGroupModal) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Edit Group</h2>
          <button class="close-btn" (click)="closeModal()">×</button>
        </div>
        
        <form (ngSubmit)="updateGroup()" class="group-form">
          <div class="form-group">
            <label for="editGroupName">Group Name *</label>
            <input 
              id="editGroupName"
              type="text" 
              [(ngModel)]="editGroupName" 
              name="editGroupName" 
              placeholder="Enter group name"
              required 
            />
          </div>

          <div class="form-group">
            <label for="editMemberSelect">Select Members</label>
            <select 
              id="editMemberSelect"
              multiple
              [(ngModel)]="editSelectedMemberIds"
              name="editMemberSelect"
              class="members-dropdown"
            >
              @for (server of availableServers; track server.id) {
                <option [value]="server.id">{{ server.full_name }} ({{ server.grade }})</option>
              }
            </select>
            <small class="help-text">Hold Ctrl/Cmd to select multiple members</small>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="closeModal()">Cancel</button>
            <button type="submit" class="submit-btn">✨ Update Group</button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
